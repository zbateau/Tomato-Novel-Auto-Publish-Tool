# 番茄小说自动发布工具

本工具是一个使用 Python 和 Playwright 开发的桌面应用程序，旨在帮助小说作者自动在番茄小说网上发布新章节。

## 功能

-   **图形用户界面 (GUI)**: 提供一个简单的界面来配置和操作发布任务。
-   **自动登录**: 支持通过浏览器扫码登录，并保存登录状态，避免重复登录。
-   **灵活的发布模式**:
    -   **立即发布**: 立即发布章节。
    -   **存为草稿**: 将章节保存为草稿，而不是立即发布。
    -   **定时发布**: 在预设的时间自动发布章节。
-   **批量发布**: 支持一次性发布指定范围内的多个章节。
-   **最速开书模式**: 为新书快速发布大量章节，以满足平台要求。
-   **从文件分解章节**: 支持将单个 `.txt` 文件按章节标记分解为多个独立的章节文件。
-   **日志记录**: 在界面上实时显示操作日志，方便追踪进度和排查问题。

## 安装

1.  **安装 Python**:
    请确保您的系统上安装了 Python 3.x。您可以从 [Python 官网](https://www.python.org/) 下载并安装。

2.  **克隆或下载项目**:
    将本项目代码下载到您的本地计算机。

3.  **安装依赖**:
    打开命令行工具，进入项目根目录，然后运行以下命令安装所需的库：

    ```bash
    pip install -r requirements.txt
    ```

    该命令会自动安装 `playwright` 库。

4.  **安装浏览器驱动**:
    Playwright 需要浏览器驱动来控制浏览器。运行以下命令来安装：

    ```bash
    playwright install
    ```

## 配置 (`config.ini.example`)

在运行程序之前，您需要配置 `config.ini` 文件。

```ini
[Settings]
; Edge 浏览器主程序（msedge.exe）的绝对路径
custom_browser_path = C:/Program Files (x86)/Microsoft/Edge Dev/Application/msedge.exe
; 番茄小说网作家后台的网址
url = https://fanqienovel.com/main/writer/?enter_from=author_zone
; 发布模式:
; publish: 立即发布
; draft: 存为草稿
; pre-publish: 定时发布
publish_mode = pre-publish
; 每日定时发布的时间 (HH:MM)
publish_time = 00:00
; 每日更新的章节数量
daily_publish_num = 2

[Novel]
; 您在番茄小说网上的小说标题
novel_title = XXXXXXXXXX
; 存放小说章节文件的文件夹路径，或单个 .txt 文件路径
novels_folder = E:\\XXXXXXXXX

[History]
; 上次发布的最后一章的章节号
last_published_chapter = 60
; 上次发布的日期
last_published_chapter_date = 2025-10-12
```

### 配置项说明

-   `custom_browser_path`: 您需要提供您电脑上安装的 Chromium 内核浏览器（如 Chrome, Edge）的可执行文件路径。
-   `url`: 一般保持默认即可。
-   `publish_mode`: 根据您的需求选择发布模式。
-   `publish_time`: 如果 `publish_mode` 设置为 `pre-publish`，此项生效。
-   `daily_publish_num`: 程序会根据此设置和历史记录自动计算下一次要发布的章节范围。
-   `novel_title`: **必须**与您在番茄小说网上的作品标题完全一致。
-   `novels_folder`:
    -   如果您的每个章节都是一个单独的 `.md` 文件，请提供存放这些文件的**文件夹路径**。
    -   如果您的所有章节都在一个 `.txt` 文件中，请提供该 `.txt` 文件的**文件路径**。程序在保存配置时会自动将其分解为多个章节文件。
-   `History`: 这些字段由程序自动更新，请勿手动修改。

## 如何使用

1.  **运行程序**:
    双击 `app.py` 或通过命令行 `python app.py` 运行程序。

2.  **配置**:
    -   在程序界面的“配置”区域填写所有必要信息。
    -   如果您提供的是一个 `.txt` 文件路径，请务必点击 **“保存配置”** 按钮，程序会自动处理文件并生成章节文件夹。
    -   确保所有路径和标题都正确无误。

3.  **登录**:
    -   点击 **“登录 (完成)”** 按钮。
    -   程序会启动您指定的浏览器并打开番茄小说网。
    -   请在浏览器中 **手动完成扫码登录**。
    -   登录成功后，**再次点击**界面上的 **“登录 (完成)”** 按钮。此时程序会保存您的登录状态到 `auth.json` 文件中，以便下次自动登录。

4.  **发布章节**:
    -   程序会根据历史记录自动填充“发布章节范围”。您可以根据需要进行修改。
    -   **后台执行**: 如果勾选，浏览器将在后台（无头模式）运行，不会显示浏览器窗口。
    -   **最速开书**: 如果勾选，程序将按照预设的模式（如 "15\*3+2\*7"）进行大批量发布，用于新书上架。
    -   点击 **“开始发布”** 按钮，程序将开始执行自动化发布流程。

5.  **查看日志**:
    所有操作的进度、成功信息和错误都将显示在“日志”区域。

## 注意事项

-   请确保您的章节文件命名规范，包含数字序号，例如 `Chapter_001.md`, `Chapter_002.md`。程序通过文件名中的数字来排序和选择章节。
-   如果从 `.txt` 文件分解章节，请确保章节标题的格式为 `第...章 ...`，并且独占一行。
-   如果程序运行出错，请根据日志区域的错误提示进行排查。
-   多书流程建议保留多个config.ini文件，每个文件对应一本小说以记录不同小说的发布状态。
-   每个config.ini文件的`novel_title`必须与番茄小说网上的作品标题完全一致。
-   在发布过程中，请勿擅自操作网页，以免干扰自动化流程。
-   建议不勾选后台执行，以方便调试和查看发布过程，如果失败可以手动干预稳定流程。
